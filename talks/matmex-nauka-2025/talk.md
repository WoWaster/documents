# Матмех-наука

## Титульник (1)

Добрый вечер, меня зовут Ефим Кубышкин и тема моего доклада "Разработка инфраструктуры для создания специализированных ускорителей на основе Interaction Nets"

## Введение (2)

Потребность в параллельной обработке данных нарастает.
Это связано как с усложнением используемых алгоритмов, так и с ростом объёма обрабатываемых данных.
Однако в ряде задач, например, связанных с обработкой графов, искусственным интеллектом и разреженной линейной алгеброй, возникает проблема нерегулярного параллелизма, с которой традиционные архитектуры в виду своей специфики справляются неэффективно.
Что заставляет задуматься об альтернативах.
Одной из таких является Interaction Nets -- формализм, для которого нерегулярный параллелизм естественен.
Однако на данный момент существуют только программные реализации, нам же интересно, насколько этот формализм хорошо себя покажет будучи реализованным в аппаратуре.

## Interaction Nets (3)

Interaction Nets -- это формализм, основанный на графовых грамматиках, соответственно процесс вычисления происходит за счёт переписываний подграфов, так же называемых редукциями.
Эти редукции локальны, что и служит основой для параллельного исполнения.
Также для этой модели доказаны такие важные свойства как полнота по Тьюрингу и независимость результата вычисления от его порядка.
Важно отметить, что меняя правила грамматики и метки на узлах можно параметризовать сети и оптимизировать вычисления для какой-то предметной области.

## Цель и задачи (4)

Соответственно, большая цель проекта, который мы назвали Lamagraph -- это разработка параметризуемого многоядерного вычислителя на основе Interaction Nets.
Для её достижения были выделены следующие шаги:
Сначала создать минимальное рабочее окружение для прототипирования вычислителей и работы с ними. Эта задача не столько инженерная, сколько исследовательская, поскольку попыток переложить Interaction Nets в аппаратуру ранее не предпринималось.
Далее разработать встроенный DSL для параметризации Interaction Nets
Потом добавить поддержку параллелизма
И в конце проводить эксперименты и, надеюсь, фиксировать прирост производительности в выделенном классе задач.

**\*клик\***

На данный момент мы находимся на первом этапе: создания инфраструктуры всего проекта.
От написания программы на более или менее привычном высокоуровневом языке программирования до получения прошивки вычислителя для ПЛИС.

## Требования к перовому этапу (5)

К первому этапу были выставлены следующие требования.

Во-первых, использование единого стека технологий.
Что должно существенно упростить как создание пайплайна, так и его поддержку.

Во-вторых, самое важное -- это получение полнофункционального прототипа. Не так важно детально проработать какую-то конкретную компоненту, как выстроить взаимодействие между ними, увидеть, где и какие здесь возникают сложности.

В-третьих, конечный этап состоит в проведении экспериментов, так что закладывать возможность сбора статистики достаточно важна, и лучше думать об этом заранее.

В-четвёртых, хочется видеть промежуточные результаты, а не идти не большим шагом. Вся цепочка довольно длинная, и процесс отладки без такой возможности значительно усложнится.

## Lamagraph (6)

На слайде представлена диаграмма, отражающее наше понимание всего пайплайна.
Проект состоит из трёх больших частей.
Интерпретатора высокоуровневого языка программирования LamagraphML, интерпретатора самих сетей и генератора вычислителя.
Входная программа на LamagraphML сначала транслируется в обогащённое $\lambda$-исчисление; далее это представление можно странслировать в сеть в текстовом представлении, для которого реализована абстрактная машина; и из текстового представления можно получить образ памяти для ПЛИС и получить прошивку.
На каждом этапе можно исполнить программу и получить статистику и результат исполнения.
На этапах, связанных с Ineraction Nets есть возможность задать параметры сети, правда пока не унифицированным способом.

В качестве основного языка программирования был выбран Haskell.
Далее рассмотрим каждую часть подробнее.

## Интерпретатор LamagraphML (7)

Начнём с интерпретатора LamagraphML.
Мы хотим использовать Interaction Nets в качестве промежуточного представления, а пользователю предоставить относительно привычный высокоуровневый язык.
Поэтому было решено использовать собственный ML-подобный язык, названный LamagraphML.
Функциональный язык выбран из-за того, что в нём удобно моделировать интересующую нас предметную область благодаря алгебраическим типам данных.
После работы фронтенда мы получаем программу в виде обогащенного $\lambda$-исчисления, которую потом можно либо интерпретировать, либо транслировать в Interaction Nets.

## Интерпретатор Interaction Nets (8)

Стандартное графовое представление, которое обычно используется для работы с Interaction Nets, плохо укладывается в функциональную парадигму, и уже описана абстрактная машина, которая работает с текстовым представлением сетей.
Так что для интерпретации Interaction Nets используется именно оно.
Здесь стоит обратить внимание: на данный момент существуют схемы трансляции только из чистого $\lambda$-исчисления.
Поэтому трансляция в Interaction Nets конструкций обогащённого $\lambda$-исчисления -- предмет дальнейшей работы.

## Генератор вычислителя (9)

Дальше сеть передаётся генератору вычислителя.
Здесь важно отметить некоторые детали реализации.
В качестве основного языка программирования был выбран Clash -- HDL, основанный на Haskell, который потом транслируется в традиционные HDL.
Такое решение продиктовано простотой, в сравнении с традиционными HDL, создания и работы с высокоуровневыми абстракциями.
Clash позволяет описывать комбинационные схемы почти как обычный Haskell код, что открывает возможность писать unit и даже property based тесты.
Более сложные последовательностные схемы же можно симулировать средствами Haskell.
Систему типов Haskell удалось утилизировать для реализации параметризации сети.

Не вдаваясь в подробности реализации вычислителя, скажем, что несмотря на наши опасения, ядро вычислителя смогло синтезироваться на не самой мощной ПЛИС, занимая при этом разумное количество ресурсов и максимальной частотой около десяти МГц.

## Текущий статус (10)

Подводя промежуточные итоги, можно сказать, получилось создать полный пайплайн: от программы на высокоуровневом языке программирования до прошивки ПЛИС, который удовлетворяет всем выставленным к нему требованиям.
Более того, удалось выяснить узкое место в виде трансляции Interaction Nets.
